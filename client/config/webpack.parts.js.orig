const HtmlWebpackHtml = require('html-webpack-plugin');
const cssnano = require('cssnano');
const webpack = require('webpack');
const PurifyCSSPlugin = require('purifycss-webpack');
const OptimizeCSSAssetsPlugin = require('optimize-css-assets-webpack-plugin');
const BabiliPlugin = require('babili-webpack-plugin');
const ExtractTextPlugin = require('extract-text-webpack-plugin');
const CleanWebpackPlugin = require('clean-webpack-plugin');
const path = require('path');
const PATHS = require('./dir.config');
const helpers = require('./helpers');

exports.baseConfig = () => ({
<<<<<<< HEAD
    entry: {
        polyfill: PATHS.polyfill,
        vendor: PATHS.vendor,
        app: PATHS.app
    },
    output: {
        path: PATHS.build,
        chunkFilename: '[name].[chunkhash:8].js',
        filename: '[name].[chunkhash:8].js'
    },
    resolve: {
        // Add `.ts` and `.tsx` as a resolvable extension.
        extensions: ['.ts', '.tsx', '.js'], // note if using webpack 1 you'd also need a '' in the array as well,
        alias: {
            stompjs$: helpers.root('src', 'typings','stompjs.js')
        }
    }, plugins: [
        new webpack.ContextReplacementPlugin(
            // The (\\|\/) piece accounts for path separators in *nix and Windows
            /angular([\\\/])core([\\\/])@angular/,
            helpers.root('./src'), // location of your src
            {} // a map of your routes
        )
    ]
});

exports.devServer = ({host, port} = {}) => ({
    devServer: {
        publicPath: '/',
        historyApiFallback: true,
        stats: 'minimal',
        host, // Defaults to `localhost`
        port, // Defaults to 8080
        overlay: {
            errors: true,
            warnings: true
        },
        proxy: {
            '/ws-weightsim': {
                target: 'ws://localhost:8081/',
                ws: true,
                secure: false
            }
        }
    }
=======
	entry: {
		polyfill: PATHS.polyfill,
		vendor: PATHS.vendor,
		app: PATHS.app
	},
	output: {
		path: PATHS.build,
		chunkFilename: '[name].[chunkhash:8].js',
		filename: '[name].[chunkhash:8].js'
	},
	resolve: {
		// Add `.ts` and `.tsx` as a resolvable extension.
		extensions: [ '.ts', '.tsx', '.js' ] // note if using webpack 1 you'd also need a '' in the array as well
	}, plugins: [
		new webpack.ContextReplacementPlugin(
			// The (\\|\/) piece accounts for path separators in *nix and Windows
			/angular([\\\/])core([\\\/])@angular/,
			helpers.root('./src'), // location of your src
			{} // a map of your routes
		)
	]
});

exports.devServer = ({ host, port } = {}) => ({
	devServer: {
		publicPath: '/',
		historyApiFallback: true,
		stats: 'minimal',
		host, // Defaults to `localhost`
		port, // Defaults to 8080
		overlay: {
			errors: true,
			warnings: true
		},
		proxy: {
			'/ws-weightsim': {
				target: 'ws://localhost/',
				ws: true
			}
		}
	}
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});

exports.lintJavaScript = ({ include, exclude, options }) => ({
	module: {
		rules: [
			{
				test: /\.js$/,
				include,
				exclude,
				enforce: 'pre',

				loader: 'eslint-loader',
				options
			}
		]
	}
});


exports.loadJavaScript = ({ include, exclude }) => ({
	module: {
		rules: [
			{
				test: /\.js$/,
				include,
				exclude,

<<<<<<< HEAD
                loader: 'babel-loader',
                options: {
                    // Enable caching for improved performance during
                    // development.
                    // It uses default OS directory by default. If you need
                    // something more custom, pass a path to it.
                    // I.e., { cacheDirectory: '<path>' }
                    cacheDirectory: true
                }
            }
        ]
    }
=======
				loader: 'babel-loader',
				options: {
					// Enable caching for improved performance during
					// development.
					// It uses default OS directory by default. If you need
					// something more custom, pass a path to it.
					// I.e., { cacheDirectory: '<path>' }
					cacheDirectory: true
				}
			}
		]
	}
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});


exports.loadCSS = ({ include, exclude, use } = {}) => ({
	module: {
		rules: [
			{
				test: /\.css$/,
				include,
				exclude,
				use
			}
		]
	}
});

<<<<<<< HEAD
exports.extractCSS = ({include, exclude, use}) => {
    // Output extracted CSS to a file
    const plugin = new ExtractTextPlugin({
        filename: '[name].[contenthash:8].css'
    });
=======
exports.extractCSS = ({ include, exclude, use }) => {
	// Output extracted CSS to a file
	const plugin = new ExtractTextPlugin({
		filename: '[name].[contenthash:8].css'
	});
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59

	return {
		module: {
			rules: [
				{
					test: /\.css$/,
					include,
					exclude,

<<<<<<< HEAD
                    use: plugin.extract({
                        use,
                        fallback: 'style-loader'
                    })
                }
            ]
        },
        plugins: [plugin]
    };
};

exports.autoprefix = () => ({
    loader: 'postcss-loader',
    options: {
        plugins: () => ([
            require('autoprefixer')()
        ])
    }
});

exports.purifyCSS = ({paths}) => ({
    plugins: [
        new PurifyCSSPlugin({paths})
    ]
});
exports.define = (variables) => ({
    plugins: [
        new webpack.DefinePlugin(variables)
    ]
=======
					use: plugin.extract({
						use,
						fallback: 'style-loader'
					})
				}
			]
		},
		plugins: [ plugin ]
	};
};

exports.autoprefix = () => ({
	loader: 'postcss-loader',
	options: {
		plugins: () => ([
			require('autoprefixer')()
		])
	}
});

exports.purifyCSS = ({ paths }) => ({
	plugins: [
		new PurifyCSSPlugin({ paths })
	]
});
exports.define = (variables) => ({
	plugins: [
		new webpack.DefinePlugin(variables)
	]
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});

exports.lintCSS = ({ include, exclude }) => ({
	module: {
		rules: [
			{
				test: /\.css$/,
				include,
				exclude,
				enforce: 'pre',

<<<<<<< HEAD
                loader: 'postcss-loader',
                options: {
                    plugins: () => ([
                        require('stylelint')()
                    ])
                }
            }
        ]
    }
=======
				loader: 'postcss-loader',
				options: {
					plugins: () => ([
						require('stylelint')()
					])
				}
			}
		]
	}
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});

exports.loadImages = ({ include, exclude, options, loader } = {}) => ({
	module: {
		rules: [
			{
				test: /\.(png|jpg|svg)$/,
				include,
				exclude,

<<<<<<< HEAD
                use: {
                    loader,
                    options
                }
            }
        ]
    }
=======
				use: {
					loader,
					options
				}
			}
		]
	}
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});

exports.loadFonts = ({ include, exclude, loader, options } = {}) => ({
	module: {
		rules: [
			{
				// Capture eot, ttf, woff, and woff2
				test: /\.(eot|ttf|woff|woff2)(\?v=\d+\.\d+\.\d+)?$/,
				include,
				exclude,

<<<<<<< HEAD
                use: {
                    loader,
                    options
                }
            }
        ]
    }
});

exports.generateSourceMaps = ({type}) => ({
    devtool: type
});

exports.extractBundles = (bundles) => ({
    plugins: bundles.map((bundle) => (
        new webpack.optimize.CommonsChunkPlugin(bundle)
    ))
});

exports.clean = (path) => ({
    plugins: [
        new CleanWebpackPlugin([path], {
            root: process.cwd()
        })
    ]
=======
				use: {
					loader,
					options
				}
			}
		]
	}
});

exports.generateSourceMaps = ({ type }) => ({
	devtool: type
});

exports.extractBundles = (bundles) => ({
	plugins: bundles.map((bundle) => (
		new webpack.optimize.CommonsChunkPlugin(bundle)
	))
});

exports.clean = (path) => ({
	plugins: [
		new CleanWebpackPlugin([ path ], {
			root: process.cwd()
		})
	]
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});


exports.minifyJavaScript = () => ({
<<<<<<< HEAD
    plugins: [
        new BabiliPlugin()
    ]
});

exports.minifyCSS = ({options}) => ({
    plugins: [
        new OptimizeCSSAssetsPlugin({
            cssProcessor: cssnano,
            cssProcessorOptions: options,
            canPrint: false
        })
    ]
});

exports.extractHTML = (templatePath) => ({
    plugins: [
        new HtmlWebpackHtml({
            template: templatePath
        })
    ]
});

exports.loadTypeScript = () => ({
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: ['awesome-typescript-loader', 'angular2-template-loader']
            }
        ]
    }
});

exports.lintTypeScript = () => ({
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                enforce: 'pre',
                loader: 'tslint-loader',
                exclude: helpers.root('node_modules'),
                options: {
                    emitErrors: false,
                    failOnHint: true
                }
            }
        ]
    }
=======
	plugins: [
		new BabiliPlugin()
	]
});

exports.minifyCSS = ({ options }) => ({
	plugins: [
		new OptimizeCSSAssetsPlugin({
			cssProcessor: cssnano,
			cssProcessorOptions: options,
			canPrint: false
		})
	]
});

exports.extractHTML = (templatePath) => ({
	plugins: [
		new HtmlWebpackHtml({
			template: templatePath
		})
	]
});

exports.loadTypeScript = () => ({
	module: {
		rules: [
			{
				test: /\.tsx?$/,
				use: [ 'awesome-typescript-loader', 'angular2-template-loader' ]
			}
		]
	}
});

exports.lintTypeScript = () => ({
	module: {
		rules: [
			{
				test: /\.tsx?$/,
				enforce: 'pre',
				loader: 'tslint-loader',
				exclude: helpers.root('node_modules'),
				options: {
					emitErrors: false,
					failOnHint: true
				}
			}
		]
	}
>>>>>>> f97c9881615f376186a100166bb0b2a2dc364a59
});
exports.loadHTML = () => ({
	module: {
		rules: [
			{
				test: /\.html$/,
				loader: 'html-loader'
			}
		]
	}
});

exports.ignoreErrors = () => ({
	plugins: [ new webpack.NoEmitOnErrorsPlugin() ]
});